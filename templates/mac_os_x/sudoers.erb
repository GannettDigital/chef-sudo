# This file is managed by Chef.
# Do NOT modify this file directly.

<% @sudoers_defaults.each do |defaults| -%>
Defaults      <%= defaults %>
<% end -%>
<% if @agent_forwarding -%>
Defaults      env_keep+=SSH_AUTH_SOCK
<% end -%>

#User privilege specification
root    ALL=(ALL) ALL
%admin  ALL=(ALL) ALL

<% if @sudoers_usersettings -%>
    <% @sudoers_usersettings.each do |user| -%>
<%= user[:name] %> <%= user[:hosts] %>=(<%= user[:runas] %>) <% if user[:passwordless] -%>NOPASSWD: <%= user[:commands] %> <% else -%><%=  user[:commands] %><% end -%>
   <% end -%>
<% else -%>
    <% @sudoers_users.each do |user| -%>
<%= user %> ALL=(ALL) <%= "NOPASSWD:" if @passwordless %>ALL
    <% end -%>
<% end -%>

#Group privilege specification
<% if @sudoers_groupsettings -%>
    <% @sudoers_groupsettings.each do |group| -%>
# Members of the '<%= group[:name] %>' may gain root privileges
<%= group[:name] %> <%= group[:hosts] %>=(<%= group[:runas] %>) <% if group[:passwordless] -%>NOPASSWD: <%= group[:commands] %> <% else -%><%=  group[:commands] %><% end -%>
    <% end -%>
<% else -%>
    <% @sudoers_groups.each do |group| -%>
<%= group %> ALL=(ALL) <%= "NOPASSWD:" if @passwordless %>ALL
    <% end -%>
<% end -%>

<%= "#includedir #{node['authorization']['sudo']['prefix']}/sudoers.d" if @include_sudoers_d  %>
